<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuro AI</title>
  <style>
    :root{
      --bg:#070812;
      --panel:#0f1118cc;
      --panelSolid:#0b0d14;
      --card:#0d0f15;
      --line:#24283a;
      --line2:#343a55;
      --text:#e9eaf2;
      --muted:#a7abc2;
      --accent1:#4f46e5;
      --accent2:#22d3ee;
      --accent3:#a855f7;
      --radius:18px;
    }
    *{ box-sizing:border-box; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body{
      margin:0; min-height:100vh; color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 15%, #4f46e533, transparent 60%),
        radial-gradient(900px 500px at 85% 20%, #22d3ee22, transparent 55%),
        radial-gradient(900px 600px at 70% 85%, #a855f722, transparent 55%),
        var(--bg);
    }

    /* Layout */
    .app{ display:grid; grid-template-columns: 280px 1fr; min-height:100vh; }
    @media (max-width: 980px){ .app{ grid-template-columns: 1fr; } .sidebar{ position:sticky; top:0; z-index:5; } }

    /* Sidebar */
    .sidebar{
      border-right:1px solid var(--line);
      background: linear-gradient(180deg, #0b0d14cc, #090a0fcc);
      backdrop-filter: blur(10px);
      padding:18px;
      display:flex; flex-direction:column; gap:14px;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
      padding:10px; border:1px solid var(--line);
      border-radius: var(--radius);
      background: #0b0d14aa;
    }
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
      box-shadow: 0 0 24px #4f46e533;
      flex:0 0 auto;
    }
    .brand h1{ margin:0; font-size:18px; letter-spacing:0.2px; }
    .brand .tag{ margin-top:2px; color:var(--muted); font-size:12px; }

    .nav{ display:flex; flex-direction:column; gap:8px; margin-top:6px; }
    .navbtn{
      border:1px solid transparent;
      background: transparent;
      color:var(--text);
      padding:12px;
      border-radius: 14px;
      cursor:pointer;
      text-align:left;
      display:flex; align-items:center; gap:10px;
    }
    .navbtn:hover{ background:#0f1118; border-color: var(--line); }
    .navbtn.active{
      background:#0f1118;
      border-color:var(--line2);
      box-shadow: 0 0 0 2px #343a5533 inset;
    }
    .dot{ width:8px; height:8px; border-radius:999px; background: #8b8fa7; }

    .upgrade{
      margin-top:auto;
      border:1px solid #3b3b55;
      background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
      color:#0b0d14;
      font-weight:900;
      padding:12px;
      border-radius: 14px;
      cursor:pointer;
    }
    .profile{
      display:flex; gap:10px; align-items:center;
      padding-top:10px; border-top:1px solid var(--line);
      color:var(--muted); font-size:13px;
    }
    .avatar{
      width:36px; height:36px; border-radius:999px;
      background:#171a28; border:1px solid var(--line);
      display:flex; align-items:center; justify-content:center;
      color:#cbd5ff; font-weight:900;
    }

    /* Main */
    .main{ padding:22px; }
    .topbar{
      display:flex; justify-content:space-between; align-items:center; gap:14px; flex-wrap:wrap;
      margin-bottom:16px;
    }
    .title h2{ margin:0; font-size:44px; letter-spacing:0.2px; }
    .title .sub{ margin-top:6px; color:var(--muted); }

    .search{
      min-width:260px; width:420px; max-width:100%;
      display:flex; gap:8px; align-items:center;
      border:1px solid var(--line);
      border-radius: 14px;
      padding:10px 12px;
      background: #0f1118cc;
      backdrop-filter: blur(10px);
    }
    .search input{
      width:100%;
      border:none; outline:none;
      background:transparent; color:var(--text);
      font-size:14px;
    }
    .kbd{
      color:var(--muted); font-size:12px;
      border:1px solid var(--line);
      padding:4px 8px;
      border-radius:10px;
      background:#0d0f15;
    }

    .panel{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel);
      backdrop-filter: blur(10px);
      padding:16px;
    }

    /* Create cards row */
    .cards{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    @media (max-width: 1100px){ .cards{ grid-template-columns: 1fr 1fr; } }
    @media (max-width: 650px){ .cards{ grid-template-columns: 1fr; } }

    .cardbtn{
      border:1px solid var(--line);
      background: #0d0f15;
      border-radius: 16px;
      padding:14px;
      cursor:pointer;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      transition: transform .05s ease;
    }
    .cardbtn:hover{ border-color:#3b3b55; }
    .cardbtn:active{ transform: translateY(1px); }
    .cardleft{ display:flex; gap:12px; align-items:center; }
    .icon{
      width:38px; height:38px; border-radius:14px;
      display:flex; align-items:center; justify-content:center;
      background: #151a2a;
      border:1px solid #2a2f48;
      color:#c7cbff;
      font-weight:900;
    }
    .cardbtn strong{ display:block; font-size:14px; }
    .cardbtn span{ display:block; margin-top:2px; color:var(--muted); font-size:12px; }
    .arrow{ color:var(--muted); font-size:18px; }

    /* Notes header */
    .notesHead{
      display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;
      margin-top:14px;
    }
    .tabs{ display:flex; gap:8px; align-items:center; }
    .tab{
      border:1px solid var(--line);
      background:#0d0f15;
      color:var(--text);
      padding:8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-size:13px;
    }
    .tab.active{ border-color:#3b3b55; box-shadow: 0 0 0 2px #3b3b5533 inset; }

    .ghost{
      border:1px solid var(--line);
      background:#0d0f15;
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-size:13px;
    }
    .ghost:hover{ border-color:#3b3b55; }

    .list{ margin-top:12px; display:flex; flex-direction:column; gap:10px; }
    .noteItem{
      border:1px solid var(--line);
      background:#0d0f15;
      border-radius: 16px;
      padding:14px;
      display:flex; justify-content:space-between; align-items:center; gap:12px;
    }
    .noteItem:hover{ border-color:#3b3b55; }
    .noteMeta strong{ display:block; font-size:14px; }
    .noteMeta .muted{ margin-top:4px; color:var(--muted); font-size:12px; }
    .btnrow{ display:flex; gap:10px; align-items:center; }

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,0.55);
      display:none; align-items:center; justify-content:center;
      padding:18px; z-index:50;
    }
    .modal{
      width:min(980px, 100%);
      border:1px solid var(--line);
      border-radius: 18px;
      background: #0b0d14f2;
      backdrop-filter: blur(12px);
      padding:16px;
    }
    .modalTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .close{
      border:1px solid var(--line);
      background:#0d0f15;
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
    }
    input, select, textarea{
      width:100%;
      border:1px solid var(--line);
      background:#0d0f15;
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      outline:none;
    }
    textarea{ min-height:300px; resize:vertical; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .primary{
      border:none;
      background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
      color:#0b0d14;
      font-weight:950;
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
    }
    .hint{ color:var(--muted); font-size:12px; margin-top:10px; line-height:1.4; }

    /* Flashcards */
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px; }
    @media (max-width: 860px){ .grid2{ grid-template-columns: 1fr; } }
    .setCard{
      border:1px solid var(--line);
      background:#0d0f15;
      border-radius:16px;
      padding:14px;
      display:flex; justify-content:space-between; gap:12px; align-items:flex-start;
    }
    .studyCard{
      border:1px solid var(--line);
      background:#0d0f15;
      border-radius:18px;
      padding:18px;
      min-height:200px;
      display:flex; align-items:center; justify-content:center;
      text-align:center;
      cursor:pointer;
      user-select:none;
      margin-top:12px;
    }
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      margin-right:8px;
      margin-top:6px;
    }

    /* Toast */
    .toast{
      position:fixed; bottom:18px; right:18px;
      background:#0d0f15; border:1px solid var(--line);
      color:var(--text);
      padding:10px 12px; border-radius:12px;
      display:none; z-index:60; max-width: 360px;
    }
    .toast small{ color:var(--muted); }
  </style>
</head>

<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>Nuro AI</h1>
          <div class="tag">Study Smarter. Level Faster.</div>
        </div>
      </div>

      <div class="nav">
        <button class="navbtn active" id="navDash" onclick="setPage('dashboard')"><span class="dot"></span> Dashboard</button>
        <button class="navbtn" id="navFlash" onclick="setPage('flash')"><span class="dot"></span> Flashcards</button>
        <button class="navbtn" id="navTests" onclick="setPage('tests')"><span class="dot"></span> Practice Tests</button>
        <button class="navbtn" id="navGuides" onclick="setPage('guides')"><span class="dot"></span> Study Guides</button>
        <button class="navbtn" id="navSettings" onclick="setPage('settings')"><span class="dot"></span> Settings</button>
      </div>

      <button class="upgrade" onclick="toast('Premium later','We‚Äôll add pricing after core features are solid.')">‚ú® Upgrade to Premium</button>

      <div class="profile">
        <div class="avatar">N</div>
        <div>
          <div style="color:var(--text); font-weight:900;">nuro user</div>
          <div>local mode</div>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div class="title">
          <h2 id="pageTitle">Dashboard</h2>
          <div class="sub" id="pageSub">Create new notes</div>
        </div>

        <div class="search">
          <input id="searchInput" placeholder="Search (Ctrl/‚åò + K)" oninput="renderNotes()" />
          <div class="kbd">‚åò K</div>
        </div>
      </div>

      <!-- DASHBOARD -->
      <section id="page_dashboard" class="panel">
        <div class="cards">
          <div class="cardbtn" onclick="newBlankDoc()">
            <div class="cardleft">
              <div class="icon">üìù</div>
              <div>
                <strong>Blank document</strong>
                <span>Start from scratch</span>
              </div>
            </div>
            <div class="arrow">‚Ä∫</div>
          </div>

          <div class="cardbtn" onclick="openModal('audio')">
            <div class="cardleft">
              <div class="icon">üéôÔ∏è</div>
              <div>
                <strong>Record or upload audio</strong>
                <span>(placeholder for now)</span>
              </div>
            </div>
            <div class="arrow">‚Ä∫</div>
          </div>

          <div class="cardbtn" onclick="openModal('doc')">
            <div class="cardleft">
              <div class="icon">üìÑ</div>
              <div>
                <strong>Document upload</strong>
                <span>PDF, DOC, PPT (UI first)</span>
              </div>
            </div>
            <div class="arrow">‚Ä∫</div>
          </div>

          <div class="cardbtn" onclick="openModal('link')">
            <div class="cardleft">
              <div class="icon">üîó</div>
              <div>
                <strong>Website link</strong>
                <span>YouTube or website link</span>
              </div>
            </div>
            <div class="arrow">‚Ä∫</div>
          </div>
        </div>

        <div class="notesHead">
          <div class="tabs">
            <button class="tab active" id="tabMy" onclick="setNotesTab('my')">My Notes</button>
            <button class="tab" id="tabShared" onclick="setNotesTab('shared')">Shared with Me</button>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="ghost" onclick="toast('Folders next','We‚Äôll add real folders next.')">üìÅ New Folder</button>
            <button class="ghost" onclick="newBlankDoc()">Ôºã New Note</button>
          </div>
        </div>

        <div class="list" id="notesList"></div>
      </section>

      <!-- FLASHCARDS -->
      <section id="page_flash" class="panel" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
          <div>
            <h3 style="margin:0 0 6px;">Flashcards</h3>
            <div style="color:var(--muted); font-size:13px;">Create sets from notes (free).</div>
          </div>
          <button class="ghost" onclick="openModal('import')">‚ú® Create from Notes</button>
        </div>
        <div id="flashRoot"></div>
      </section>

      <!-- PRACTICE TESTS -->
      <section id="page_tests" class="panel" style="display:none;">
        <h3 style="margin:0 0 6px;">Practice Tests</h3>
        <div style="color:var(--muted); font-size:13px; line-height:1.4;">
          Build tests you can customize. (Real test-taking next)
        </div>

        <div class="row" style="margin-top:12px;">
          <div style="flex:1; min-width:220px;">
            <label style="color:var(--muted); font-size:13px;">Title</label>
            <input id="testTitle" placeholder="e.g., Bio Test #1" />
          </div>
          <div style="flex:1; min-width:220px;">
            <label style="color:var(--muted); font-size:13px;">Subject</label>
            <input id="testSubject" placeholder="e.g., Biology" />
          </div>
        </div>

        <div class="row">
          <div style="flex:1; min-width:220px;">
            <label style="color:var(--muted); font-size:13px;"># Questions</label>
            <select id="testCount">
              <option>5</option><option>10</option><option selected>15</option><option>20</option><option>30</option>
            </select>
          </div>
          <div style="flex:1; min-width:220px;">
            <label style="color:var(--muted); font-size:13px;">Difficulty</label>
            <select id="testDiff">
              <option>Easy</option><option selected>Medium</option><option>Hard</option>
            </select>
          </div>
        </div>

        <div style="margin-top:10px;">
          <label style="color:var(--muted); font-size:13px;">Topics (comma separated)</label>
          <input id="testTopics" placeholder="cells, mitosis, genetics" />
        </div>

        <div class="row">
          <button class="primary" onclick="createTest()">Create Test</button>
          <button class="ghost" onclick="toast('Next upgrade','Timed + scored tests.')">Coming next</button>
        </div>

        <div class="list" id="testsList"></div>
      </section>

      <!-- GUIDES -->
      <section id="page_guides" class="panel" style="display:none;">
        <h3 style="margin:0 0 6px;">Study Guides</h3>
        <div style="color:var(--muted); font-size:13px; line-height:1.4;">
          Next we‚Äôll add: checklists, roadmaps, weak-area summaries.
          For now, use Notes ‚Üí Flashcards / Tests.
        </div>
        <div style="margin-top:12px;">
          <span class="pill">Notes ‚Üí flashcards</span>
          <span class="pill">Custom tests</span>
          <span class="pill">Score + weak topics (next)</span>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="page_settings" class="panel" style="display:none;">
        <h3 style="margin:0 0 6px;">Settings</h3>
        <div style="color:var(--muted); font-size:13px; line-height:1.4;">
          Local mode: everything saves in your browser.
        </div>

        <div class="row">
          <button class="ghost" onclick="exportAll()">‚¨áÔ∏è Export Data</button>
          <button class="ghost" onclick="importAll()">‚¨ÜÔ∏è Import Data</button>
          <button class="ghost" onclick="resetAll()">üóëÔ∏è Reset All</button>
        </div>
      </section>
    </main>
  </div>

  <!-- NOTE EDITOR -->
  <div class="overlay" id="modal_note">
    <div class="modal">
      <div class="modalTop">
        <div style="flex:1;"><input id="noteTitle" placeholder="Note title..." /></div>
        <button class="close" onclick="closeModal('note')">Close</button>
      </div>
      <textarea id="noteBody" placeholder="Write your notes here..."></textarea>
      <div class="row">
        <button class="primary" onclick="saveNote()">Save</button>
        <button class="ghost" onclick="duplicateNote()">Duplicate</button>
        <button class="ghost" onclick="deleteOpenNote()">Delete</button>
        <button class="ghost" onclick="openFromNoteToImport()">‚ú® Generate Flashcards</button>
      </div>
      <div class="hint">Tip: Use ‚ÄúTerm - definition‚Äù or ‚ÄúQ: / A:‚Äù format for best results.</div>
    </div>
  </div>

  <!-- LINK MODAL -->
  <div class="overlay" id="modal_link">
    <div class="modal">
      <div class="modalTop">
        <div style="flex:1; font-weight:900;">Add website link</div>
        <button class="close" onclick="closeModal('link')">Close</button>
      </div>
      <div class="row">
        <div style="flex:1; min-width:240px;">
          <label style="color:var(--muted); font-size:13px;">Title</label>
          <input id="linkTitle" placeholder="e.g., Biology Crash Course" />
        </div>
        <div style="flex:1; min-width:240px;">
          <label style="color:var(--muted); font-size:13px;">URL</label>
          <input id="linkUrl" placeholder="https://..." />
        </div>
      </div>
      <div class="row">
        <button class="primary" onclick="saveLink()">Save link</button>
      </div>
      <div class="hint">Links appear in your Notes list.</div>
    </div>
  </div>

  <!-- DOC MODAL -->
  <div class="overlay" id="modal_doc">
    <div class="modal">
      <div class="modalTop">
        <div style="flex:1; font-weight:900;">Document upload (UI)</div>
        <button class="close" onclick="closeModal('doc')">Close</button>
      </div>
      <div class="hint">For now: saves file metadata locally. Parsing comes later.</div>
      <input type="file" id="docFile" />
      <div class="row">
        <button class="primary" onclick="saveDocMeta()">Save document</button>
      </div>
    </div>
  </div>

  <!-- AUDIO MODAL -->
  <div class="overlay" id="modal_audio">
    <div class="modal">
      <div class="modalTop">
        <div style="flex:1; font-weight:900;">Audio upload (placeholder)</div>
        <button class="close" onclick="closeModal('audio')">Close</button>
      </div>
      <div class="hint">For now: saves audio file metadata. Transcript later.</div>
      <input type="file" id="audioFile" accept="audio/*" />
      <div class="row">
        <button class="primary" onclick="saveAudioMeta()">Save audio</button>
      </div>
    </div>
  </div>

  <!-- IMPORT FLASHCARDS -->
  <div class="overlay" id="modal_import">
    <div class="modal">
      <div class="modalTop">
        <div style="flex:1; font-weight:950;">Create flashcards from notes</div>
        <button class="close" onclick="closeModal('import')">Close</button>
      </div>

      <div class="row">
        <div style="flex:1; min-width:240px;">
          <label style="color:var(--muted); font-size:13px;">Set name</label>
          <input id="impSetName" placeholder="e.g., Biology Unit 3" />
        </div>
        <div style="flex:1; min-width:240px;">
          <label style="color:var(--muted); font-size:13px;">Subject</label>
          <input id="impSubject" placeholder="e.g., Biology" />
        </div>
      </div>

      <div class="row">
        <div style="flex:1; min-width:240px;">
          <label style="color:var(--muted); font-size:13px;">Card style</label>
          <select id="impStyle">
            <option value="auto" selected>Auto (best guess)</option>
            <option value="qa">Q&A (Q: ... / A: ...)</option>
            <option value="def">Definitions (Term - definition)</option>
            <option value="bullets">Bullets (each bullet = card)</option>
          </select>
        </div>
        <div style="flex:1; min-width:240px;">
          <label style="color:var(--muted); font-size:13px;">Max cards</label>
          <select id="impMax">
            <option>10</option><option selected>20</option><option>30</option><option>50</option>
          </select>
        </div>
      </div>

      <div style="margin-top:10px;">
        <label style="color:var(--muted); font-size:13px;">Paste notes</label>
        <textarea id="impText" placeholder="Paste your notes here..."></textarea>
      </div>

      <div class="row">
        <button class="primary" onclick="importFlashcards()">Generate</button>
        <button class="ghost" onclick="toast('Tip','Use Term - definition or Q:/A: format for best results.')">Help</button>
      </div>

      <div class="hint">This uses smart rules (free). Later you can add AI.</div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // Keys
    const NOTES_KEY = "nuro_notes_v3";
    const FLASH_KEY = "nuro_flash_v3";
    const TESTS_KEY = "nuro_tests_v3";

    // State
    let notesState = loadNotes();
    let flashState = loadFlash();
    let testsState = loadTests();
    let openNoteId = null;

    // ---------- Load/Save ----------
    function nid(){ return Math.random().toString(16).slice(2) + Date.now().toString(16); }

    function loadNotes(){
      const raw = localStorage.getItem(NOTES_KEY);
      if(raw) return JSON.parse(raw);
      return {
        notesTab: "my",
        notes: [
          { id:nid(), type:"note", title:"Welcome to Nuro AI", updatedAt:Date.now()-86400000*2, body:"Paste notes here.\n\nFormats:\nTerm - definition\nQ: ...\nA: ...\n- bullet point" }
        ]
      };
    }
    function saveNotes(){ localStorage.setItem(NOTES_KEY, JSON.stringify(notesState)); }

    function loadFlash(){
      const raw = localStorage.getItem(FLASH_KEY);
      if(raw) return JSON.parse(raw);
      return { sets: [], study:{ setId:null, index:0, showBack:false } };
    }
    function saveFlash(){ localStorage.setItem(FLASH_KEY, JSON.stringify(flashState)); }

    function loadTests(){
      const raw = localStorage.getItem(TESTS_KEY);
      if(raw) return JSON.parse(raw);
      return { items: [] };
    }
    function saveTests(){ localStorage.setItem(TESTS_KEY, JSON.stringify(testsState)); }

    // ---------- Nav ----------
    function setPage(next){
      document.getElementById("navDash").classList.toggle("active", next==="dashboard");
      document.getElementById("navFlash").classList.toggle("active", next==="flash");
      document.getElementById("navTests").classList.toggle("active", next==="tests");
      document.getElementById("navGuides").classList.toggle("active", next==="guides");
      document.getElementById("navSettings").classList.toggle("active", next==="settings");

      show("page_dashboard", next==="dashboard");
      show("page_flash", next==="flash");
      show("page_tests", next==="tests");
      show("page_guides", next==="guides");
      show("page_settings", next==="settings");

      const title = document.getElementById("pageTitle");
      const sub = document.getElementById("pageSub");

      if(next==="dashboard"){ title.textContent="Dashboard"; sub.textContent="Create new notes"; }
      if(next==="flash"){ title.textContent="Flashcards"; sub.textContent="Study sets you created"; renderFlash(); }
      if(next==="tests"){ title.textContent="Practice Tests"; sub.textContent="Build custom tests"; renderTests(); }
      if(next==="guides"){ title.textContent="Study Guides"; sub.textContent="Roadmaps coming next"; }
      if(next==="settings"){ title.textContent="Settings"; sub.textContent="Export/import/reset"; }
    }
    function show(id, on){ document.getElementById(id).style.display = on ? "" : "none"; }

    // ---------- Notes ----------
    function setNotesTab(which){
      notesState.notesTab = which;
      saveNotes();
      document.getElementById("tabMy").classList.toggle("active", which==="my");
      document.getElementById("tabShared").classList.toggle("active", which==="shared");
      renderNotes();
    }

    function renderNotes(){
      const list = document.getElementById("notesList");
      if(notesState.notesTab === "shared"){
        list.innerHTML = `
          <div class="noteItem">
            <div class="noteMeta">
              <strong>Shared with Me</strong>
              <div class="muted">Sharing needs accounts. We‚Äôll add later.</div>
            </div>
            <div class="btnrow">
              <button class="ghost" onclick="toast('Coming soon','Login + sharing later.')">Info</button>
            </div>
          </div>`;
        return;
      }

      const q = (document.getElementById("searchInput").value || "").trim().toLowerCase();
      const items = notesState.notes.slice().sort((a,b)=>b.updatedAt-a.updatedAt).filter(n=>{
        const blob = `${n.title||""} ${n.body||""} ${n.url||""}`.toLowerCase();
        return q ? blob.includes(q) : true;
      });

      if(items.length===0){
        list.innerHTML = `<div style="color:var(--muted); font-size:13px;">No notes yet. Create one.</div>`;
        return;
      }

      list.innerHTML = items.map(n=>{
        const icon = n.type==="link" ? "üîó" : (n.type==="doc" ? "üìÑ" : (n.type==="audio" ? "üéôÔ∏è" : "üìù"));
        const subtitle =
          n.type==="link" ? `Website link ‚Ä¢ ${safe(n.url||"")}` :
          n.type==="doc" ? `Document ‚Ä¢ ${safe(n.fileName||"")}` :
          n.type==="audio" ? `Audio ‚Ä¢ ${safe(n.fileName||"")}` :
          `Last opened ${timeAgo(n.updatedAt)}`;

        return `
          <div class="noteItem">
            <div class="noteMeta">
              <strong>${icon} ${safe(n.title||"Untitled")}</strong>
              <div class="muted">${subtitle}</div>
            </div>
            <div class="btnrow">
              <button class="ghost" onclick="openItem('${n.id}')">Open</button>
              <button class="ghost" onclick="deleteItem('${n.id}')">Delete</button>
            </div>
          </div>`;
      }).join("");
    }

    function newBlankDoc(){
      const n = { id:nid(), type:"note", title:"Untitled note", updatedAt:Date.now(), body:"" };
      notesState.notes.unshift(n);
      saveNotes();
      openItem(n.id);
      renderNotes();
    }

    function openItem(id){
      const n = notesState.notes.find(x=>x.id===id);
      if(!n) return;

      if(n.type==="link"){ window.open(n.url, "_blank"); return; }
      if(n.type==="doc" || n.type==="audio"){ toast("Saved locally","Metadata stored. Parsing later."); return; }

      openNoteId = id;
      document.getElementById("noteTitle").value = n.title||"";
      document.getElementById("noteBody").value = n.body||"";
      openModal("note");
    }

    function saveNote(){
      if(!openNoteId) return;
      const n = notesState.notes.find(x=>x.id===openNoteId);
      if(!n) return;
      n.title = (document.getElementById("noteTitle").value||"").trim() || "Untitled note";
      n.body = (document.getElementById("noteBody").value||"").trim();
      n.updatedAt = Date.now();
      saveNotes();
      toast("Saved","Your note is saved.");
      renderNotes();
    }

    function duplicateNote(){
      if(!openNoteId) return;
      const n = notesState.notes.find(x=>x.id===openNoteId);
      if(!n) return;
      const copy = { ...n, id:nid(), title:(n.title||"Untitled")+" (copy)", updatedAt:Date.now() };
      notesState.notes.unshift(copy);
      saveNotes();
      toast("Duplicated","Created a copy.");
      renderNotes();
    }

    function deleteOpenNote(){
      if(!openNoteId) return;
      deleteItem(openNoteId);
      closeModal("note");
    }

    function deleteItem(id){
      const n = notesState.notes.find(x=>x.id===id);
      if(!n) return;
      if(!confirm(`Delete "${n.title||"Untitled"}"?`)) return;
      notesState.notes = notesState.notes.filter(x=>x.id!==id);
      saveNotes();
      toast("Deleted","Item removed.");
      renderNotes();
    }

    // ---------- Modals ----------
    function openModal(name){
      document.getElementById("modal_"+name).style.display="flex";
    }
    function closeModal(name){
      document.getElementById("modal_"+name).style.display="none";
    }

    // Link/doc/audio save
    function saveLink(){
      const title = (document.getElementById("linkTitle").value||"").trim() || "Website link";
      const url = (document.getElementById("linkUrl").value||"").trim();
      if(!url.startsWith("http")){ alert("URL must start with http(s)://"); return; }
      notesState.notes.unshift({ id:nid(), type:"link", title, url, updatedAt:Date.now() });
      saveNotes();
      document.getElementById("linkTitle").value="";
      document.getElementById("linkUrl").value="";
      closeModal("link");
      toast("Link saved", title);
      renderNotes();
    }

    function saveDocMeta(){
      const f = document.getElementById("docFile").files[0];
      if(!f){ alert("Choose a file first."); return; }
      notesState.notes.unshift({ id:nid(), type:"doc", title:f.name, fileName:f.name, mime:f.type, size:f.size, updatedAt:Date.now() });
      saveNotes();
      document.getElementById("docFile").value="";
      closeModal("doc");
      toast("Document saved","Metadata stored.");
      renderNotes();
    }

    function saveAudioMeta(){
      const f = document.getElementById("audioFile").files[0];
      if(!f){ alert("Choose an audio file first."); return; }
      notesState.notes.unshift({ id:nid(), type:"audio", title:f.name, fileName:f.name, mime:f.type, size:f.size, updatedAt:Date.now() });
      saveNotes();
      document.getElementById("audioFile").value="";
      closeModal("audio");
      toast("Audio saved","Metadata stored.");
      renderNotes();
    }

    // ---------- Flashcards ----------
    function openFromNoteToImport(){
      const n = notesState.notes.find(x=>x.id===openNoteId);
      if(!n) return;
      closeModal("note");
      document.getElementById("impSetName").value = n.title || "Flashcards";
      document.getElementById("impSubject").value = "General";
      document.getElementById("impText").value = n.body || "";
      document.getElementById("impStyle").value = "auto";
      document.getElementById("impMax").value = "20";
      openModal("import");
    }

    function importFlashcards(){
      const name = (document.getElementById("impSetName").value||"").trim() || "Flashcards";
      const subject = (document.getElementById("impSubject").value||"").trim() || "General";
      const style = document.getElementById("impStyle").value;
      const maxCards = parseInt(document.getElementById("impMax").value,10);
      const text = (document.getElementById("impText").value||"").trim();
      if(!text){ alert("Paste some notes first."); return; }

      const cards = makeCards(text, style).slice(0, maxCards);
      if(cards.length===0){ alert("Couldn‚Äôt detect cards. Try Term - definition or Q:/A: format."); return; }

      flashState.sets.unshift({ id:nid(), name, subject, createdAt:Date.now(), cards });
      saveFlash();
      closeModal("import");
      toast("Flashcards created", `${cards.length} cards`);
      setPage("flash");
    }

    function makeCards(text, style){
      const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);

      const looksQA = lines.some(l=>/^q[:\-]/i.test(l)) && lines.some(l=>/^a[:\-]/i.test(l));
      const looksDef = lines.some(l=>/(.+)\s[-‚Äì‚Äî:]\s(.+)/.test(l));
      const looksBul = lines.filter(l=>/^[-‚Ä¢*]\s+/.test(l)).length >= 3;

      let mode = style;
      if(mode==="auto"){
        if(looksQA) mode="qa";
        else if(looksDef) mode="def";
        else if(looksBul) mode="bullets";
        else mode="bullets";
      }

      if(mode==="qa"){
        const out=[]; let q=null;
        for(const l of lines){
          if(/^q[:\-]/i.test(l)){ q=l.replace(/^q[:\-]\s*/i,"").trim(); continue; }
          if(/^a[:\-]/i.test(l) && q){
            const a=l.replace(/^a[:\-]\s*/i,"").trim();
            out.push({front:q, back:a});
            q=null;
          }
        }
        return out;
      }

      if(mode==="def"){
        const out=[];
        for(const l of lines){
          const m=l.match(/^(.+?)\s*[-‚Äì‚Äî:]\s*(.+)$/);
          if(m) out.push({front:m[1].trim(), back:m[2].trim()});
        }
        return out;
      }

      // bullets
      const bullets = lines.map(l=>l.replace(/^[-‚Ä¢*]\s+/,"").trim()).filter(l=>l.length>=4);
      return bullets.map(b=>{
        if(b.length>90 && b.includes(":")){
          const [a,...rest]=b.split(":");
          return {front:a.trim(), back:rest.join(":").trim()};
        }
        return {front:b, back:"(tap to add your own explanation)"};
      });
    }

    function renderFlash(){
      const root = document.getElementById("flashRoot");
      const study = flashState.study || { setId:null, index:0, showBack:false };

      if(study.setId){
        const set = flashState.sets.find(s=>s.id===study.setId);
        if(!set){ flashState.study={setId:null,index:0,showBack:false}; saveFlash(); renderFlash(); return; }
        const c = set.cards[study.index];
        const face = study.showBack ? c.back : c.front;

        root.innerHTML = `
          <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; margin-top:10px;">
            <div>
              <div style="font-weight:950; font-size:16px;">Study: ${safe(set.name)}</div>
              <div style="color:var(--muted); font-size:13px;">${study.index+1} / ${set.cards.length} ‚Ä¢ click card to flip</div>
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
              <button class="ghost" onclick="shuffleStudy()">Shuffle</button>
              <button class="ghost" onclick="exitStudy()">Exit</button>
            </div>
          </div>

          <div class="studyCard" onclick="flipStudy()">
            <div style="font-size:16px; line-height:1.4;">${safe(face)}</div>
          </div>

          <div class="row">
            <button class="ghost" onclick="nextStudy()">Next</button>
          </div>
        `;
        return;
      }

      if(flashState.sets.length===0){
        root.innerHTML = `<div style="margin-top:12px; color:var(--muted); font-size:13px;">No sets yet. Create from Notes.</div>`;
        return;
      }

      root.innerHTML = `
        <div class="grid2">
          ${flashState.sets.map(s=>`
            <div class="setCard">
              <div>
                <div style="font-weight:950;">${safe(s.name)}</div>
                <div style="color:var(--muted); font-size:12px; margin-top:4px;">${safe(s.subject)} ‚Ä¢ ${s.cards.length} cards</div>
                <div class="pill">created ${timeAgo(s.createdAt)}</div>
              </div>
              <div class="btnrow">
                <button class="ghost" onclick="startStudy('${s.id}')">Study</button>
                <button class="ghost" onclick="deleteSet('${s.id}')">Delete</button>
              </div>
            </div>
          `).join("")}
        </div>
      `;
    }

    function startStudy(setId){
      flashState.study = { setId, index:0, showBack:false };
      saveFlash(); renderFlash();
    }
    function exitStudy(){ flashState.study={setId:null,index:0,showBack:false}; saveFlash(); renderFlash(); }
    function flipStudy(){ flashState.study.showBack = !flashState.study.showBack; saveFlash(); renderFlash(); }
    function nextStudy(){
      const set = flashState.sets.find(s=>s.id===flashState.study.setId);
      if(!set) return;
      flashState.study.index = (flashState.study.index+1) % set.cards.length;
      flashState.study.showBack=false;
      saveFlash(); renderFlash();
    }
    function shuffleStudy(){
      const set = flashState.sets.find(s=>s.id===flashState.study.setId);
      if(!set) return;
      set.cards.sort(()=>Math.random()-0.5);
      flashState.study.index=0; flashState.study.showBack=false;
      saveFlash(); renderFlash();
    }
    function deleteSet(id){
      if(!confirm("Delete this flashcard set?")) return;
      flashState.sets = flashState.sets.filter(s=>s.id!==id);
      flashState.study = { setId:null, index:0, showBack:false };
      saveFlash(); renderFlash();
    }

    // ---------- Tests ----------
    function createTest(){
      const title = (document.getElementById("testTitle").value||"").trim();
      if(!title){ alert("Title is required."); return; }
      const subject = (document.getElementById("testSubject").value||"").trim() || "General";
      const count = parseInt(document.getElementById("testCount").value,10);
      const diff = document.getElementById("testDiff").value;
      const topics = (document.getElementById("testTopics").value||"").trim();

      testsState.items.unshift({ id:nid(), title, subject, count, diff, topics, createdAt:Date.now() });
      saveTests();
      document.getElementById("testTitle").value="";
      document.getElementById("testSubject").value="";
      document.getElementById("testTopics").value="";
      toast("Test created", title);
      renderTests();
    }

    function renderTests(){
      const list = document.getElementById("testsList");
      if(testsState.items.length===0){
        list.innerHTML = `<div style="margin-top:12px; color:var(--muted); font-size:13px;">No tests yet. Create one above.</div>`;
        return;
      }
      list.innerHTML = testsState.items.map(t=>`
        <div class="noteItem">
          <div class="noteMeta">
            <strong>üìù ${safe(t.title)}</strong>
            <div class="muted">${safe(t.subject)} ‚Ä¢ ${t.count} Q ‚Ä¢ ${safe(t.diff)} ‚Ä¢ ${safe(t.topics||"no topics")}</div>
          </div>
          <div class="btnrow">
            <button class="ghost" onclick="toast('Next upgrade','Real test-taking mode soon.')">Open</button>
            <button class="ghost" onclick="deleteTest('${t.id}')">Delete</button>
          </div>
        </div>
      `).join("");
    }

    function deleteTest(id){
      if(!confirm("Delete this test?")) return;
      testsState.items = testsState.items.filter(x=>x.id!==id);
      saveTests(); renderTests();
    }

    // ---------- Settings ----------
    function exportAll(){
      const payload = { notesState, flashState, testsState };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type:"application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "nuro-ai-export.json";
      a.click();
      URL.revokeObjectURL(url);
      toast("Exported","Downloaded your data.");
    }
    function importAll(){
      const input = document.createElement("input");
      input.type="file";
      input.accept="application/json";
      input.onchange=()=>{
        const f=input.files[0];
        if(!f) return;
        const r=new FileReader();
        r.onload=()=>{
          try{
            const p=JSON.parse(r.result);
            notesState=p.notesState||notesState;
            flashState=p.flashState||flashState;
            testsState=p.testsState||testsState;
            saveNotes(); saveFlash(); saveTests();
            toast("Imported","Data loaded.");
            renderNotes(); renderFlash(); renderTests();
            setPage("dashboard");
          }catch(e){ alert("Invalid JSON."); }
        };
        r.readAsText(f);
      };
      input.click();
    }
    function resetAll(){
      if(!confirm("Delete ALL local data?")) return;
      localStorage.removeItem(NOTES_KEY);
      localStorage.removeItem(FLASH_KEY);
      localStorage.removeItem(TESTS_KEY);
      notesState = loadNotes();
      flashState = loadFlash();
      testsState = loadTests();
      toast("Reset","All data cleared.");
      renderNotes(); renderFlash(); renderTests();
      setPage("dashboard");
    }

    // ---------- Utils ----------
    function safe(s){
      return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
    function timeAgo(ts){
      const d = Date.now()-ts;
      const m = Math.floor(d/60000);
      if(m<60) return `${m} min ago`;
      const h = Math.floor(m/60);
      if(h<24) return `${h} hours ago`;
      const days = Math.floor(h/24);
      return `${days} days ago`;
    }
    function toast(title, msg=""){
      const t=document.getElementById("toast");
      t.innerHTML = `<div style="font-weight:950;">${safe(title)}</div><small>${safe(msg)}</small>`;
      t.style.display="block";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>t.style.display="none", 2600);
    }

    // Keyboard shortcut
    document.addEventListener("keydown",(e)=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==="k"){
        e.preventDefault();
        document.getElementById("searchInput").focus();
      }
      if(e.key==="Escape"){
        ["note","link","doc","audio","import"].forEach(n=>{
          const el=document.getElementById("modal_"+n);
          if(el && el.style.display==="flex") el.style.display="none";
        });
      }
    });

    // Boot
    setNotesTab(notesState.notesTab || "my");
    renderNotes();
    renderFlash();
    renderTests();
  </script>
</body>
</html>
