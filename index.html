<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuro AI</title>
  <style>
    :root{
      --bg:#0a0b10;
      --panel:#0f1118cc;
      --panel2:#0d0f15;
      --card:#121522;
      --line:#24283a;
      --text:#e9eaf2;
      --muted:#a7abc2;
      --accent1:#4f46e5;
      --accent2:#22d3ee;
      --accent3:#a855f7;
      --good:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
      --radius:18px;
    }
    *{ box-sizing:border-box; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body{
      margin:0; min-height:100vh; color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 15%, #4f46e533, transparent 60%),
        radial-gradient(900px 500px at 85% 20%, #22d3ee22, transparent 55%),
        radial-gradient(900px 600px at 70% 85%, #a855f722, transparent 55%),
        var(--bg);
    }

    /* Layout */
    .app{
      display:grid;
      grid-template-columns: 280px 1fr;
      min-height:100vh;
    }
    @media (max-width: 980px){
      .app{ grid-template-columns: 1fr; }
      .sidebar{ position:sticky; top:0; z-index:5; }
    }

    /* Sidebar */
    .sidebar{
      border-right:1px solid var(--line);
      background: linear-gradient(180deg, #0b0d14cc, #090a0fcc);
      backdrop-filter: blur(10px);
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
      padding:10px 10px; border:1px solid var(--line);
      border-radius: var(--radius);
      background: #0b0d14aa;
    }
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
      box-shadow: 0 0 24px #4f46e533;
      flex:0 0 auto;
    }
    .brand h1{ margin:0; font-size:18px; letter-spacing:0.2px; }
    .brand .tag{ margin-top:2px; color:var(--muted); font-size:12px; }

    .nav{
      display:flex; flex-direction:column; gap:8px;
      margin-top:6px;
    }
    .navbtn{
      border:1px solid transparent;
      background: transparent;
      color:var(--text);
      padding:12px 12px;
      border-radius: 14px;
      cursor:pointer;
      text-align:left;
      display:flex; align-items:center; gap:10px;
    }
    .navbtn:hover{ background:#0f1118; border-color: var(--line); }
    .navbtn.active{
      background:#0f1118;
      border-color:#343a55;
      box-shadow: 0 0 0 2px #343a5533 inset;
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: #8b8fa7;
    }
    .upgrade{
      margin-top:auto;
      border:1px solid #3b3b55;
      background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
      color:#0b0d14;
      font-weight:800;
      padding:12px 12px;
      border-radius: 14px;
      cursor:pointer;
    }
    .profile{
      display:flex; gap:10px; align-items:center;
      padding-top:10px; border-top:1px solid var(--line);
      color:var(--muted); font-size:13px;
    }
    .avatar{
      width:36px; height:36px; border-radius:999px;
      background:#171a28; border:1px solid var(--line);
      display:flex; align-items:center; justify-content:center;
      color:#cbd5ff; font-weight:800;
    }

    /* Main */
    .main{
      padding:22px;
    }
    .topbar{
      display:flex; justify-content:space-between; align-items:center; gap:14px; flex-wrap:wrap;
      margin-bottom:16px;
    }
    .title h2{ margin:0; font-size:40px; letter-spacing:0.2px; }
    .title .sub{ margin-top:6px; color:var(--muted); }
    .search{
      min-width:260px; width:380px; max-width:100%;
      display:flex; gap:8px; align-items:center;
      border:1px solid var(--line);
      border-radius: 14px;
      padding:10px 12px;
      background: #0f1118cc;
      backdrop-filter: blur(10px);
    }
    .search input{
      width:100%;
      border:none; outline:none;
      background:transparent; color:var(--text);
      font-size:14px;
    }
    .search .kbd{
      color:var(--muted); font-size:12px;
      border:1px solid var(--line);
      padding:4px 8px;
      border-radius:10px;
      background:#0d0f15;
    }

    .panel{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel);
      backdrop-filter: blur(10px);
      padding:16px;
    }

    /* Create cards */
    .cards{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    @media (max-width: 1100px){ .cards{ grid-template-columns: 1fr 1fr; } }
    @media (max-width: 650px){ .cards{ grid-template-columns: 1fr; } }

    .cardbtn{
      border:1px solid var(--line);
      background: #0d0f15;
      border-radius: 16px;
      padding:14px;
      cursor:pointer;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      transition: transform .05s ease;
    }
    .cardbtn:hover{ border-color:#3b3b55; }
    .cardbtn:active{ transform: translateY(1px); }
    .cardleft{ display:flex; gap:12px; align-items:center; }
    .icon{
      width:38px; height:38px; border-radius:14px;
      display:flex; align-items:center; justify-content:center;
      background: #151a2a;
      border:1px solid #2a2f48;
      color:#c7cbff;
      font-weight:900;
    }
    .cardbtn strong{ display:block; font-size:14px; }
    .cardbtn span{ display:block; margin-top:2px; color:var(--muted); font-size:12px; }
    .arrow{ color:var(--muted); font-size:18px; }

    /* Notes section */
    .notesHead{
      display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;
      margin-top:14px;
    }
    .tabs{
      display:flex; gap:8px; align-items:center;
    }
    .tab{
      border:1px solid var(--line);
      background:#0d0f15;
      color:var(--text);
      padding:8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-size:13px;
    }
    .tab.active{ border-color:#3b3b55; box-shadow: 0 0 0 2px #3b3b5533 inset; }
    .ghost{
      border:1px solid var(--line);
      background:#0d0f15;
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-size:13px;
    }
    .ghost:hover{ border-color:#3b3b55; }

    .list{
      margin-top:12px;
      display:flex; flex-direction:column; gap:10px;
    }
    .noteItem{
      border:1px solid var(--line);
      background:#0d0f15;
      border-radius: 16px;
      padding:14px;
      display:flex; justify-content:space-between; align-items:center; gap:12px;
    }
    .noteItem:hover{ border-color:#3b3b55; }
    .noteMeta strong{ display:block; font-size:14px; }
    .noteMeta .muted{ margin-top:4px; color:var(--muted); font-size:12px; }
    .kebab{
      width:38px; height:38px; border-radius: 12px;
      border:1px solid var(--line);
      background:#0b0d14;
      color:var(--muted);
      cursor:pointer;
    }

    /* Modal */
    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,0.55);
      display:none; align-items:center; justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modal{
      width:min(900px, 100%);
      border:1px solid var(--line);
      border-radius: 18px;
      background: #0b0d14f2;
      backdrop-filter: blur(12px);
      padding:16px;
    }
    .modalTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .modalTop input{
      width:100%;
      border:1px solid var(--line);
      background:#0d0f15;
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      outline:none;
    }
    .close{
      border:1px solid var(--line);
      background:#0d0f15;
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
    }
    .editor{
      width:100%;
      min-height:320px;
      border:1px solid var(--line);
      background:#0d0f15;
      color:var(--text);
      padding:12px;
      border-radius: 14px;
      resize:vertical;
      outline:none;
    }
    .modalRow{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
    }
    .primary{
      border:none;
      background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
      color:#0b0d14;
      font-weight:900;
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
    }
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
    }
    .hint{
      color:var(--muted);
      font-size:12px;
      margin-top:10px;
      line-height:1.4;
    }
    .two{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px;
    }
    @media (max-width: 780px){ .two{ grid-template-columns: 1fr; } }

    /* Simple toast */
    .toast{
      position:fixed; bottom:18px; right:18px;
      background:#0d0f15; border:1px solid var(--line);
      color:var(--text);
      padding:10px 12px; border-radius:12px;
      display:none;
      z-index:60;
      max-width: 320px;
    }
    .toast small{ color:var(--muted); }
  </style>
</head>

<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>Nuro AI</h1>
          <div class="tag">Study Smarter. Level Faster.</div>
        </div>
      </div>

      <div class="nav">
        <button class="navbtn active" id="navDash" onclick="setPage('dashboard')"><span class="dot"></span> Dashboard</button>
        <button class="navbtn" id="navGuides" onclick="setPage('guides')"><span class="dot"></span> Study Guides</button>
        <button class="navbtn" id="navSettings" onclick="setPage('settings')"><span class="dot"></span> Settings</button>
      </div>

      <button class="upgrade" onclick="toast('Premium later', 'We‚Äôll add pricing when the product is bigger.')">‚ú® Upgrade to Premium</button>

      <div class="profile">
        <div class="avatar">N</div>
        <div>
          <div style="color:var(--text); font-weight:800;">nuro user</div>
          <div>local mode</div>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <div class="title">
          <h2 id="pageTitle">Dashboard</h2>
          <div class="sub" id="pageSub">Create new notes</div>
        </div>

        <div class="search">
          <input id="searchInput" placeholder="Search (Ctrl/‚åò + K)" oninput="renderNotes()" />
          <div class="kbd">‚åò K</div>
        </div>
      </div>

      <!-- Pages -->
      <section id="page_dashboard" class="panel">
        <div class="cards">
          <div class="cardbtn" onclick="newBlankDoc()">
            <div class="cardleft">
              <div class="icon">üìù</div>
              <div>
                <strong>Blank document</strong>
                <span>Start from scratch</span>
              </div>
            </div>
            <div class="arrow">‚Ä∫</div>
          </div>

          <div class="cardbtn" onclick="openAudioModal()">
            <div class="cardleft">
              <div class="icon">üéôÔ∏è</div>
              <div>
                <strong>Record or upload audio</strong>
                <span>(placeholder for now)</span>
              </div>
            </div>
            <div class="arrow">‚Ä∫</div>
          </div>

          <div class="cardbtn" onclick="openUploadModal()">
            <div class="cardleft">
              <div class="icon">üìÑ</div>
              <div>
                <strong>Document upload</strong>
                <span>PDF, DOC, PPT (UI first)</span>
              </div>
            </div>
            <div class="arrow">‚Ä∫</div>
          </div>

          <div class="cardbtn" onclick="openLinkModal()">
            <div class="cardleft">
              <div class="icon">üîó</div>
              <div>
                <strong>Website link</strong>
                <span>YouTube or website link</span>
              </div>
            </div>
            <div class="arrow">‚Ä∫</div>
          </div>
        </div>

        <div class="notesHead">
          <div class="tabs">
            <button class="tab active" id="tabMy" onclick="setNotesTab('my')">My Notes</button>
            <button class="tab" id="tabShared" onclick="setNotesTab('shared')">Shared with Me</button>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="ghost" onclick="newFolder()">üìÅ New Folder</button>
            <button class="ghost" onclick="newBlankDoc()">Ôºã New Note</button>
          </div>
        </div>

        <div class="list" id="notesList"></div>
      </section>

      <section id="page_guides" class="panel" style="display:none;">
        <div class="two">
          <div class="panel" style="background:#0b0d14aa;">
            <h3 style="margin:0 0 6px;">Study Guides</h3>
            <div style="color:var(--muted); font-size:13px; line-height:1.4;">
              Next we‚Äôll add: exam checklists, topic roadmaps, and ‚Äúweak-area‚Äù summaries.
              <br><br>
              For now, your guides come from your notes:
              <ul>
                <li>Make a note</li>
                <li>Click ‚ÄúOpen‚Äù</li>
                <li>Use ‚ÄúGenerate Flashcards/Test‚Äù (next upgrade)</li>
              </ul>
            </div>
          </div>

          <div class="panel" style="background:#0b0d14aa;">
            <h3 style="margin:0 0 6px;">Coming next</h3>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <span class="pill">Paste notes ‚Üí flashcards</span>
              <span class="pill">Timed practice tests</span>
              <span class="pill">Score & weak topics</span>
              <span class="pill">Export/import sets</span>
            </div>
          </div>
        </div>
      </section>

      <section id="page_settings" class="panel" style="display:none;">
        <h3 style="margin:0 0 6px;">Settings</h3>
        <div style="color:var(--muted); font-size:13px; line-height:1.4;">
          This version is ‚Äúlocal mode‚Äù ‚Äî everything saves in your browser.
          <br><br>
          Settings we can add:
          <ul>
            <li>Theme toggle</li>
            <li>Font size</li>
            <li>Export / import your data</li>
          </ul>
        </div>

        <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
          <button class="ghost" onclick="exportData()">‚¨áÔ∏è Export Data</button>
          <button class="ghost" onclick="importData()">‚¨ÜÔ∏è Import Data</button>
          <button class="ghost" onclick="resetAll()">üóëÔ∏è Reset All</button>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal: Editor -->
  <div class="modalOverlay" id="editorOverlay">
    <div class="modal">
      <div class="modalTop">
        <div style="flex:1;">
          <input id="noteTitle" placeholder="Note title..." />
        </div>
        <button class="close" onclick="closeEditor()">Close</button>
      </div>

      <textarea class="editor" id="noteBody" placeholder="Write your notes here..."></textarea>

      <div class="modalRow">
        <button class="primary" onclick="saveNote()">Save</button>
        <button class="ghost" onclick="duplicateNote()">Duplicate</button>
        <button class="ghost" onclick="deleteOpenNote()">Delete</button>
        <button class="ghost" onclick="toast('Next upgrade', 'We will add: Generate Flashcards + Generate Test from this note.')">‚ú® Generate</button>
      </div>

      <div class="hint">
        Tip: This is the Turbo-style workspace. Next we‚Äôll connect notes ‚Üí flashcards/tests automatically.
      </div>
    </div>
  </div>

  <!-- Modal: Link -->
  <div class="modalOverlay" id="linkOverlay">
    <div class="modal">
      <div class="modalTop">
        <div style="flex:1; font-weight:900;">Add website link</div>
        <button class="close" onclick="closeLinkModal()">Close</button>
      </div>

      <div class="two">
        <div>
          <label style="color:var(--muted); font-size:13px;">Title</label>
          <input id="linkTitle" placeholder="e.g., Biology Crash Course" />
        </div>
        <div>
          <label style="color:var(--muted); font-size:13px;">URL</label>
          <input id="linkUrl" placeholder="https://..." />
        </div>
      </div>

      <div class="modalRow">
        <button class="primary" onclick="saveLink()">Save link</button>
      </div>
      <div class="hint">Links are saved to your ‚ÄúMy Notes‚Äù list.</div>
    </div>
  </div>

  <!-- Modal: Upload -->
  <div class="modalOverlay" id="uploadOverlay">
    <div class="modal">
      <div class="modalTop">
        <div style="flex:1; font-weight:900;">Document upload (UI)</div>
        <button class="close" onclick="closeUploadModal()">Close</button>
      </div>

      <div class="panel" style="background:#0d0f15; border-radius:16px;">
        <div style="color:var(--muted); font-size:13px; line-height:1.4;">
          For now this stores the file name + type (local). Real PDF parsing is the next step.
        </div>
        <div style="height:10px"></div>
        <input type="file" id="docFile" />
        <div class="modalRow">
          <button class="primary" onclick="saveDocMeta()">Save document</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Audio -->
  <div class="modalOverlay" id="audioOverlay">
    <div class="modal">
      <div class="modalTop">
        <div style="flex:1; font-weight:900;">Audio (placeholder)</div>
        <button class="close" onclick="closeAudioModal()">Close</button>
      </div>

      <div class="panel" style="background:#0d0f15; border-radius:16px;">
        <div style="color:var(--muted); font-size:13px; line-height:1.4;">
          We can add real recording later. For now you can upload an audio file name to track it.
        </div>
        <div style="height:10px"></div>
        <input type="file" id="audioFile" accept="audio/*" />
        <div class="modalRow">
          <button class="primary" onclick="saveAudioMeta()">Save audio</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ----------------- DATA -----------------
    const KEY = "nuro_workspace_v1";

    function load(){
      const raw = localStorage.getItem(KEY);
      if(raw) return JSON.parse(raw);
      return {
        notesTab: "my",
        folders: [{ id:id(), name:"Earlier" }],
        notes: [
          // Example welcome note
          { id:id(), type:"note", title:"Welcome to Nuro AI", folderId:null, updatedAt:Date.now()-86400000*2, body:"Create notes, then (next upgrade) turn them into flashcards + practice tests." }
        ]
      };
    }
    function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
    function id(){ return Math.random().toString(16).slice(2) + Date.now().toString(16); }

    let state = load();
    let page = "dashboard";
    let openNoteId = null;

    // ----------------- PAGE NAV -----------------
    function setPage(next){
      page = next;
      document.getElementById("navDash").classList.toggle("active", next==="dashboard");
      document.getElementById("navGuides").classList.toggle("active", next==="guides");
      document.getElementById("navSettings").classList.toggle("active", next==="settings");

      document.getElementById("page_dashboard").style.display = next==="dashboard" ? "" : "none";
      document.getElementById("page_guides").style.display = next==="guides" ? "" : "none";
      document.getElementById("page_settings").style.display = next==="settings" ? "" : "none";

      const title = document.getElementById("pageTitle");
      const sub = document.getElementById("pageSub");

      if(next==="dashboard"){ title.textContent="Dashboard"; sub.textContent="Create new notes"; }
      if(next==="guides"){ title.textContent="Study Guides"; sub.textContent="Build guides from notes"; }
      if(next==="settings"){ title.textContent="Settings"; sub.textContent="Local mode controls"; }
    }

    // ----------------- NOTES TAB -----------------
    function setNotesTab(which){
      state.notesTab = which;
      save();
      document.getElementById("tabMy").classList.toggle("active", which==="my");
      document.getElementById("tabShared").classList.toggle("active", which==="shared");
      renderNotes();
    }

    // ----------------- NOTES LIST -----------------
    function renderNotes(){
      const list = document.getElementById("notesList");
      if(!list) return;

      if(state.notesTab === "shared"){
        list.innerHTML = `
          <div class="noteItem">
            <div class="noteMeta">
              <strong>Shared with Me</strong>
              <div class="muted">Accounts/sharing comes later. For now everything is local.</div>
            </div>
            <button class="kebab" onclick="toast('Coming soon','We can add login + sharing later.')">‚ãÆ</button>
          </div>
        `;
        return;
      }

      const q = (document.getElementById("searchInput")?.value || "").trim().toLowerCase();
      const items = state.notes
        .slice()
        .sort((a,b)=> (b.updatedAt||0) - (a.updatedAt||0))
        .filter(n => {
          const blob = `${n.title||""} ${n.body||""} ${n.url||""}`.toLowerCase();
          return q ? blob.includes(q) : true;
        });

      if(items.length === 0){
        list.innerHTML = `<div style="color:var(--muted); font-size:13px;">No notes match your search.</div>`;
        return;
      }

      list.innerHTML = items.map(n => {
        const when = timeAgo(n.updatedAt);
        const icon = n.type==="link" ? "üîó" : (n.type==="doc" ? "üìÑ" : (n.type==="audio" ? "üéôÔ∏è" : "üìù"));
        const subtitle =
          n.type==="link" ? `Website link ‚Ä¢ ${safe(n.url||"")}` :
          n.type==="doc" ? `Document ‚Ä¢ ${safe(n.fileName||"")}` :
          n.type==="audio" ? `Audio ‚Ä¢ ${safe(n.fileName||"")}` :
          `Last opened ${when}`;

        return `
          <div class="noteItem">
            <div class="noteMeta">
              <strong>${icon} ${safe(n.title || "Untitled")}</strong>
              <div class="muted">${subtitle}</div>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
              <button class="ghost" onclick="openItem('${n.id}')">Open</button>
              <button class="kebab" onclick="deleteItem('${n.id}')">‚ãÆ</button>
            </div>
          </div>
        `;
      }).join("");
    }

    function openItem(noteId){
      const n = state.notes.find(x => x.id === noteId);
      if(!n) return;

      if(n.type === "link"){
        window.open(n.url, "_blank");
        return;
      }
      if(n.type === "doc" || n.type === "audio"){
        toast("Saved locally", "We stored file metadata. Next: parsing/transcripts.");
        return;
      }

      openNoteId = noteId;
      document.getElementById("noteTitle").value = n.title || "";
      document.getElementById("noteBody").value = n.body || "";
      document.getElementById("editorOverlay").style.display = "flex";
    }

    // ----------------- CREATE / EDIT -----------------
    function newBlankDoc(){
      const n = { id:id(), type:"note", title:"Untitled note", folderId:null, updatedAt:Date.now(), body:"" };
      state.notes.unshift(n);
      save();
      openItem(n.id);
      renderNotes();
    }

    function closeEditor(){
      document.getElementById("editorOverlay").style.display = "none";
      openNoteId = null;
    }

    function saveNote(){
      if(!openNoteId) return;
      const n = state.notes.find(x => x.id === openNoteId);
      if(!n) return;
      n.title = (document.getElementById("noteTitle").value || "").trim() || "Untitled note";
      n.body = (document.getElementById("noteBody").value || "").trim();
      n.updatedAt = Date.now();
      save();
      toast("Saved", "Your note is saved locally.");
      renderNotes();
    }

    function duplicateNote(){
      if(!openNoteId) return;
      const n = state.notes.find(x => x.id === openNoteId);
      if(!n) return;
      const copy = { ...n, id:id(), title:`${n.title || "Untitled"} (copy)`, updatedAt:Date.now() };
      state.notes.unshift(copy);
      save();
      toast("Duplicated", "Created a copy.");
      renderNotes();
    }

    function deleteOpenNote(){
      if(!openNoteId) return;
      deleteItem(openNoteId);
      closeEditor();
    }

    function deleteItem(noteId){
      const n = state.notes.find(x => x.id === noteId);
      if(!n) return;
      if(!confirm(`Delete "${n.title || "Untitled"}"?`)) return;
      state.notes = state.notes.filter(x => x.id !== noteId);
      save();
      toast("Deleted", "Item removed.");
      renderNotes();
    }

    // ----------------- FOLDERS -----------------
    function newFolder(){
      const name = prompt("Folder name?");
      if(!name) return;
      state.folders.unshift({ id:id(), name:name.trim() });
      save();
      toast("Folder created", name.trim());
    }

    // ----------------- LINK MODAL -----------------
    function openLinkModal(){ document.getElementById("linkOverlay").style.display="flex"; }
    function closeLinkModal(){ document.getElementById("linkOverlay").style.display="none"; }
    function saveLink(){
      const title = (document.getElementById("linkTitle").value || "").trim() || "Website link";
      const url = (document.getElementById("linkUrl").value || "").trim();
      if(!url.startsWith("http")) { alert("Please enter a valid URL starting with http(s)://"); return; }

      state.notes.unshift({ id:id(), type:"link", title, url, updatedAt:Date.now() });
      save();
      closeLinkModal();
      document.getElementById("linkTitle").value = "";
      document.getElementById("linkUrl").value = "";
      toast("Link saved", title);
      renderNotes();
    }

    // ----------------- UPLOAD MODAL (metadata) -----------------
    function openUploadModal(){ document.getElementById("uploadOverlay").style.display="flex"; }
    function closeUploadModal(){ document.getElementById("uploadOverlay").style.display="none"; }
    function saveDocMeta(){
      const f = document.getElementById("docFile").files[0];
      if(!f){ alert("Choose a file first."); return; }
      state.notes.unshift({
        id:id(), type:"doc", title:f.name, fileName:f.name, mime:f.type, size:f.size, updatedAt:Date.now()
      });
      save();
      closeUploadModal();
      document.getElementById("docFile").value = "";
      toast("Document saved", "Metadata stored locally.");
      renderNotes();
    }

    // ----------------- AUDIO MODAL (metadata) -----------------
    function openAudioModal(){ document.getElementById("audioOverlay").style.display="flex"; }
    function closeAudioModal(){ document.getElementById("audioOverlay").style.display="none"; }
    function saveAudioMeta(){
      const f = document.getElementById("audioFile").files[0];
      if(!f){ alert("Choose an audio file first."); return; }
      state.notes.unshift({
        id:id(), type:"audio", title:f.name, fileName:f.name, mime:f.type, size:f.size, updatedAt:Date.now()
      });
      save();
      closeAudioModal();
      document.getElementById("audioFile").value = "";
      toast("Audio saved", "Metadata stored locally.");
      renderNotes();
    }

    // ----------------- SETTINGS: EXPORT/IMPORT/RESET -----------------
    function exportData(){
      const blob = new Blob([JSON.stringify(state, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "nuro-ai-export.json";
      a.click();
      URL.revokeObjectURL(url);
      toast("Exported", "Downloaded your data file.");
    }

    function importData(){
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.onchange = () => {
        const f = input.files[0];
        if(!f) return;
        const r = new FileReader();
        r.onload = () => {
          try{
            const parsed = JSON.parse(r.result);
            state = parsed;
            save();
            toast("Imported", "Data loaded.");
            renderNotes();
          }catch(e){
            alert("Invalid JSON file.");
          }
        };
        r.readAsText(f);
      };
      input.click();
    }

    function resetAll(){
      if(!confirm("This deletes everything saved on this device. Continue?")) return;
      localStorage.removeItem(KEY);
      state = load();
      save();
      toast("Reset", "All local data cleared.");
      renderNotes();
    }

    // ----------------- UTIL -----------------
    function safe(s){
      return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
    function timeAgo(ts){
      if(!ts) return "‚Äî";
      const d = Date.now() - ts;
      const mins = Math.floor(d/60000);
      if(mins < 60) return `${mins} min ago`;
      const hrs = Math.floor(mins/60);
      if(hrs < 24) return `${hrs} hours ago`;
      const days = Math.floor(hrs/24);
      return `${days} days ago`;
    }
    function toast(title, msg){
      const t = document.getElementById("toast");
      t.innerHTML = `<div style="font-weight:900;">${safe(title)}</div><small>${safe(msg)}</small>`;
      t.style.display = "block";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=> t.style.display="none", 2600);
    }

    // Boot
    setNotesTab(state.notesTab || "my");
    renderNotes();

    // (Optional) keyboard focus imitation
    document.addEventListener("keydown", (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "k"){
        e.preventDefault();
        document.getElementById("searchInput").focus();
      }
    });
  </script>
</body>
</html>
